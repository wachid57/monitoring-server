import{r as i,j as e,B as x,A as j,z as f,C as g}from"./index-CJWZi9CB.js";import{D as J,X as U,_ as Y,b as Z,z as $}from"./index.esm-CBP19pFL.js";import{P as Q}from"./PageContainer-BR_WMDrZ.js";import{B as V}from"./Breadcrumb-DR6zDa-i.js";import{C as ee}from"./Card-BdzGKbvD.js";import{C as se}from"./CardContent-B4ITIunY.js";import{S as C}from"./Stack-C8hAk-Ua.js";import{B as N}from"./Box-B21Vn3Wr.js";import{T as y}from"./TextField-ZPSYDyyk.js";import{I as re}from"./InputAdornment-DP5E7Axe.js";import{B as l}from"./Button-BH1WbAiu.js";import{A as te}from"./Alert-NqiMgJWO.js";import{C as W}from"./CircularProgress-DjzG6_YG.js";import{T as ie}from"./TableContainer-C29JBPns.js";import{P as oe}from"./Paper-Dk0UhltF.js";import{T as ne,d as ae,b as w,c as t,a as le}from"./TableRow-BlqcCBcb.js";import{T as b}from"./Typography-DW8TAfFy.js";import{I as D}from"./IconButton-Cf6Oa_Gi.js";import{a as _,b as G}from"./DialogContent-iZlfiihu.js";import{D as O}from"./DialogTitle-fL9kXoX8.js";import{D as R}from"./DialogActions-WyzZcgZE.js";import"./Grid2-TKUllLdh.js";import"./composeClasses-CkcSq-l_.js";import"./index-BwqtTtay.js";import"./useSlotProps-Dmx4i6VU.js";import"./Link-DrUusogV.js";import"./createStack-B05ZxkoV.js";import"./useSlot-BJnJs1tW.js";import"./FormControl-CoJ51_a0.js";import"./utils-DoM3o7-Q.js";import"./useFormControl-D8zMB56u.js";import"./isMuiElement-DUOjtQlD.js";import"./useId-5Do1p0JB.js";import"./formControlState-Dq1zat_P.js";import"./Select-BdS4d3Pw.js";import"./Popover-C4QiusQk.js";import"./isHostComponent-DVu5iVWx.js";import"./Modal-BmV9fUd8.js";import"./getReactNodeRef-CxaND9dZ.js";import"./ownerWindow-CPegdbNg.js";import"./createChainedFunction-BO_9K8Jh.js";import"./utils-C-EoFTAL.js";import"./Portal-BXG2mGLy.js";import"./debounce-Be36O1Ab.js";import"./Grow-rhCcvyQJ.js";import"./List-CPHbMiuQ.js";import"./useControlled-Cuh16IWT.js";import"./resolveProps-CxWqPvcr.js";import"./Close-4pq8Nglm.js";const me=[{to:"/",title:"Home"},{title:"Admin"},{title:"Permissions"},{title:"List Permissions"}],os=()=>{var E;const[F,A]=i.useState([]),[H,T]=i.useState(!1),[P,o]=i.useState(""),[a,M]=i.useState(""),[p,m]=i.useState({open:!1,perm:null}),[X,c]=i.useState(!1),[h,S]=i.useState(""),[u,L]=i.useState(""),[k,v]=i.useState(!1),z=async()=>{T(!0),o("");try{const s=await fetch(x+j+"/permissions/",{method:"GET",headers:f()});if(s.status===401||s.status===403){g({status:s.status});return}const r=await s.json();s.ok?A(Array.isArray(r)?r:r.permissions||[]):o(r.error||r.message||"Gagal mengambil data permissions")}catch(s){console.error("Fetch permissions error:",s),o("Terjadi kesalahan saat mengambil data permissions")}finally{T(!1)}},K=async s=>{try{const r=await fetch(x+j+`/permissions/${s}`,{method:"DELETE",headers:f()});if(r.status===401||r.status===403){g({status:r.status});return}if(r.ok)A(n=>n.filter(d=>d.id!==s)),m({open:!1,perm:null});else{const n=await r.json();o(n.error||n.message||"Gagal menghapus permission")}}catch(r){console.error("Delete permission error:",r),o("Terjadi kesalahan saat menghapus permission")}},q=async()=>{if(!h||!u){o("Permission name and description are required");return}v(!0),o("");try{const s=await fetch(x+j+"/permissions/",{method:"POST",headers:{"Content-Type":"application/json",...f()},body:JSON.stringify({name:h,description:u,module:"general",action:"read"})});if(s.status===401||s.status===403){g({status:s.status});return}const r=await s.json();s.ok?(c(!1),S(""),L(""),z()):o(r.error||r.message||"Gagal menambahkan permission")}catch(s){console.error("Add permission error:",s),o("Terjadi kesalahan saat menambahkan permission")}finally{v(!1)}},B=F.filter(s=>{var r,n,d,I;return((r=s.name)==null?void 0:r.toLowerCase().includes(a.toLowerCase()))||((n=s.description)==null?void 0:n.toLowerCase().includes(a.toLowerCase()))||((d=s.module)==null?void 0:d.toLowerCase().includes(a.toLowerCase()))||((I=s.action)==null?void 0:I.toLowerCase().includes(a.toLowerCase()))});return i.useEffect(()=>{z()},[]),e.jsxs(Q,{title:"List Permissions",description:"Manage system permissions",children:[e.jsx(V,{title:"List Permissions",items:me}),e.jsx(ee,{children:e.jsxs(se,{children:[e.jsxs(C,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(N,{sx:{minWidth:300},children:e.jsx(y,{placeholder:"Search permissions...",value:a,onChange:s=>M(s.target.value),InputProps:{startAdornment:e.jsx(re,{position:"start",children:e.jsx(J,{size:20})})},fullWidth:!0})}),e.jsx(l,{variant:"contained",startIcon:e.jsx(U,{}),color:"primary",onClick:()=>c(!0),sx:{width:300},children:"Add Permission"})]}),P&&e.jsx(te,{severity:"error",sx:{mb:3},children:P}),H?e.jsx(N,{display:"flex",justifyContent:"center",py:4,children:e.jsx(W,{})}):e.jsx(ie,{component:oe,children:e.jsxs(ne,{children:[e.jsx(ae,{children:e.jsxs(w,{children:[e.jsx(t,{children:"ID"}),e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Description"}),e.jsx(t,{children:"Module"}),e.jsx(t,{children:"Action"}),e.jsx(t,{children:"Created"}),e.jsx(t,{align:"center",children:"Actions"})]})}),e.jsx(le,{children:B.length===0?e.jsx(w,{children:e.jsx(t,{colSpan:7,align:"center",sx:{py:4},children:e.jsx(b,{variant:"body1",color:"textSecondary",children:a?"No permissions found matching your search":"No permissions found"})})}):B.map(s=>e.jsxs(w,{children:[e.jsx(t,{children:s.id}),e.jsx(t,{children:e.jsx(b,{variant:"subtitle2",fontWeight:600,children:s.name})}),e.jsx(t,{children:s.description||"-"}),e.jsx(t,{children:s.module||"-"}),e.jsx(t,{children:s.action||"-"}),e.jsx(t,{children:s.created_at?new Date(s.created_at).toLocaleDateString():"-"}),e.jsx(t,{align:"center",children:e.jsxs(C,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(D,{size:"small",color:"primary",children:e.jsx(Y,{size:16})}),e.jsx(D,{size:"small",color:"warning",children:e.jsx(Z,{size:16})}),e.jsx(D,{size:"small",color:"error",onClick:()=>m({open:!0,perm:s}),children:e.jsx($,{size:16})})]})})]},s.id))})]})})]})}),e.jsxs(_,{open:p.open,onClose:()=>m({open:!1,perm:null}),children:[e.jsx(O,{children:"Confirm Delete"}),e.jsx(G,{children:e.jsxs(b,{children:['Are you sure you want to delete permission "',(E=p.perm)==null?void 0:E.name,'"? This action cannot be undone.']})}),e.jsxs(R,{children:[e.jsx(l,{onClick:()=>m({open:!1,perm:null}),color:"primary",children:"Cancel"}),e.jsx(l,{onClick:()=>{var s;return K((s=p.perm)==null?void 0:s.id)},color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(_,{open:X,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(O,{children:"Add Permission"}),e.jsx(G,{children:e.jsxs(C,{spacing:2,mt:1,children:[e.jsx(y,{label:"Permission Name",value:h,onChange:s=>S(s.target.value),fullWidth:!0}),e.jsx(y,{label:"Description",value:u,onChange:s=>L(s.target.value),fullWidth:!0,multiline:!0,rows:3})]})}),e.jsxs(R,{children:[e.jsx(l,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(l,{onClick:q,variant:"contained",disabled:k,children:k?e.jsx(W,{size:18}):"Add Permission"})]})]})]})};export{os as default};
