import{r as i,j as e,B as j,A as f,z as g,C}from"./index-CJWZi9CB.js";import{D as K,X as M,_ as $,b as J,z as U}from"./index.esm-CBP19pFL.js";import{P as Y}from"./PageContainer-BR_WMDrZ.js";import{B as Z}from"./Breadcrumb-DR6zDa-i.js";import{C as q}from"./Card-BdzGKbvD.js";import{C as G}from"./CardContent-B4ITIunY.js";import{S as _}from"./Stack-C8hAk-Ua.js";import{B as k}from"./Box-B21Vn3Wr.js";import{T as d}from"./TextField-ZPSYDyyk.js";import{I as Q}from"./InputAdornment-DP5E7Axe.js";import{B as h}from"./Button-BH1WbAiu.js";import{A as V}from"./Alert-NqiMgJWO.js";import{C as z}from"./CircularProgress-DjzG6_YG.js";import{T as ee}from"./TableContainer-C29JBPns.js";import{P as se}from"./Paper-Dk0UhltF.js";import{T as te,d as re,b as v,c as o,a as oe}from"./TableRow-BlqcCBcb.js";import{I as w}from"./IconButton-Cf6Oa_Gi.js";import{a as I,b as P}from"./DialogContent-iZlfiihu.js";import{D as B}from"./DialogTitle-fL9kXoX8.js";import{T as ae}from"./Typography-DW8TAfFy.js";import{D as E}from"./DialogActions-WyzZcgZE.js";import"./Grid2-TKUllLdh.js";import"./composeClasses-CkcSq-l_.js";import"./index-BwqtTtay.js";import"./useSlotProps-Dmx4i6VU.js";import"./Link-DrUusogV.js";import"./createStack-B05ZxkoV.js";import"./useSlot-BJnJs1tW.js";import"./FormControl-CoJ51_a0.js";import"./utils-DoM3o7-Q.js";import"./useFormControl-D8zMB56u.js";import"./isMuiElement-DUOjtQlD.js";import"./useId-5Do1p0JB.js";import"./formControlState-Dq1zat_P.js";import"./Select-BdS4d3Pw.js";import"./Popover-C4QiusQk.js";import"./isHostComponent-DVu5iVWx.js";import"./Modal-BmV9fUd8.js";import"./getReactNodeRef-CxaND9dZ.js";import"./ownerWindow-CPegdbNg.js";import"./createChainedFunction-BO_9K8Jh.js";import"./utils-C-EoFTAL.js";import"./Portal-BXG2mGLy.js";import"./debounce-Be36O1Ab.js";import"./Grow-rhCcvyQJ.js";import"./List-CPHbMiuQ.js";import"./useControlled-Cuh16IWT.js";import"./resolveProps-CxWqPvcr.js";import"./Close-4pq8Nglm.js";const ie=[{to:"/",title:"Home"},{title:"Hosts"},{title:"List Hosts"}],ts=()=>{var L;const[W,D]=i.useState([]),[F,T]=i.useState(!1),[b,l]=i.useState(""),[m,N]=i.useState(""),[x,p]=i.useState({open:!1,host:null}),[O,u]=i.useState(!1),[a,c]=i.useState({ip:"",hostname:"",alias:"",service:"",hosts_tags:""}),[R,y]=i.useState(!1),S=async()=>{T(!0),l("");try{const s=await fetch(j+f+"/hosts",{headers:g()});if(s.status===401||s.status===403){C({status:s.status});return}const r=await s.json();if(s.ok){const n=(r||[]).map(t=>({id:t.ID??t.id,ip:t.IP??t.ip,hostname:t.Hostname??t.hostname,alias:t.Alias??t.alias,service:t.Service??t.service,hosts_tags:t.HostsTags??t.hosts_tags??t.hostsTags??"",created_at:t.CreatedAt??t.created_at}));D(n)}else l(r.error||"Failed to fetch hosts")}catch(s){console.error("fetch hosts error",s),l("Failed to fetch hosts")}finally{T(!1)}},X=async s=>{try{const r=await fetch(j+f+`/hosts/${s}`,{method:"DELETE",headers:g()});if(r.status===401||r.status===403)return C({status:r.status});if(r.ok)D(n=>n.filter(t=>t.id!==s)),p({open:!1,host:null});else{const n=await r.json();l(n.error||"Failed to delete host")}}catch(r){console.error("delete host error",r),l("Failed to delete host")}},H=W.filter(s=>{var r,n,t;return((r=s.hostname)==null?void 0:r.toLowerCase().includes(m.toLowerCase()))||((n=s.ip)==null?void 0:n.toLowerCase().includes(m.toLowerCase()))||((t=s.alias)==null?void 0:t.toLowerCase().includes(m.toLowerCase()))});i.useEffect(()=>{S()},[]);const A=s=>{window.location.href=`/infrastructure/hosts/${s}`};return e.jsxs(Y,{title:"List Hosts",description:"Manage monitored hosts",children:[e.jsx(Z,{title:"List Hosts",items:ie}),e.jsx(q,{children:e.jsxs(G,{children:[e.jsxs(_,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(k,{sx:{minWidth:300},children:e.jsx(d,{placeholder:"Search hosts...",value:m,onChange:s=>N(s.target.value),InputProps:{startAdornment:e.jsx(Q,{position:"start",children:e.jsx(K,{size:20})})},fullWidth:!0})}),e.jsx(h,{variant:"contained",startIcon:e.jsx(M,{}),onClick:()=>u(!0),sx:{width:225},children:"Add Host"})]}),b&&e.jsx(V,{severity:"error",sx:{mb:3},children:b}),F?e.jsx(k,{display:"flex",justifyContent:"center",py:4,children:e.jsx(z,{})}):e.jsx(ee,{component:se,children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsxs(v,{children:[e.jsx(o,{children:"IP"}),e.jsx(o,{children:"Hostname"}),e.jsx(o,{children:"Alias"}),e.jsx(o,{children:"Service"}),e.jsx(o,{children:"Tags"}),e.jsx(o,{children:"Created"}),e.jsx(o,{align:"center",children:"Actions"})]})}),e.jsx(oe,{children:H.length===0?e.jsx(v,{children:e.jsx(o,{colSpan:7,align:"center",children:"No hosts found"})}):H.map(s=>e.jsxs(v,{children:[e.jsx(o,{children:s.ip||"-"}),e.jsx(o,{children:e.jsx(h,{variant:"text",onClick:()=>A(s.id),children:s.hostname||"-"})}),e.jsx(o,{children:s.alias||"-"}),e.jsx(o,{children:s.service||"-"}),e.jsx(o,{children:s.hosts_tags||"-"}),e.jsx(o,{children:s.created_at?new Date(s.created_at).toLocaleDateString():"-"}),e.jsx(o,{align:"center",children:e.jsxs(_,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(w,{size:"small",color:"primary",onClick:()=>A(s.id),children:e.jsx($,{size:16})}),e.jsx(w,{size:"small",color:"warning",children:e.jsx(J,{size:16})}),e.jsx(w,{size:"small",color:"error",onClick:()=>p({open:!0,host:s}),children:e.jsx(U,{size:16})})]})})]},s.id))})]})})]})}),e.jsxs(I,{open:x.open,onClose:()=>p({open:!1,host:null}),children:[e.jsx(B,{children:"Confirm Delete"}),e.jsx(P,{children:e.jsxs(ae,{children:['Delete host "',(L=x.host)==null?void 0:L.hostname,'"?']})}),e.jsxs(E,{children:[e.jsx(h,{onClick:()=>p({open:!1,host:null}),children:"Cancel"}),e.jsx(h,{color:"error",variant:"contained",onClick:()=>{var s;return X((s=x.host)==null?void 0:s.id)},children:"Delete"})]})]}),e.jsxs(I,{open:O,onClose:()=>u(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(B,{children:"Add Host"}),e.jsxs(P,{children:[e.jsx(d,{label:"IP",fullWidth:!0,margin:"dense",value:a.ip,onChange:s=>c({...a,ip:s.target.value})}),e.jsx(d,{label:"Hostname",fullWidth:!0,margin:"dense",value:a.hostname,onChange:s=>c({...a,hostname:s.target.value})}),e.jsx(d,{label:"Alias",fullWidth:!0,margin:"dense",value:a.alias,onChange:s=>c({...a,alias:s.target.value})}),e.jsx(d,{label:"Service",fullWidth:!0,margin:"dense",value:a.service,onChange:s=>c({...a,service:s.target.value})}),e.jsx(d,{label:"Tags",fullWidth:!0,margin:"dense",value:a.hosts_tags,onChange:s=>c({...a,hosts_tags:s.target.value})})]}),e.jsxs(E,{children:[e.jsx(h,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(h,{variant:"contained",color:"primary",onClick:async()=>{y(!0);try{const s=await fetch(j+f+"/hosts",{method:"POST",headers:{"Content-Type":"application/json",...g()},body:JSON.stringify(a)});if(s.status===401||s.status===403)return C({status:s.status});const r=await s.json();s.ok?(S(),u(!1),c({ip:"",hostname:"",alias:"",service:"",hosts_tags:""})):l(r.error||"Failed to create host")}catch(s){console.error(s),l("Failed to create host")}finally{y(!1)}},children:R?e.jsx(z,{size:20}):"Create"})]})]})]})};export{ts as default};
