import{r as i,j as e,B as x,A as j,z as g,C as b}from"./index-CJWZi9CB.js";import{D as U,X as $,_ as Y,b as Z,z as q}from"./index.esm-CBP19pFL.js";import{P as G}from"./PageContainer-BR_WMDrZ.js";import{B as Q}from"./Breadcrumb-DR6zDa-i.js";import{C as V}from"./Card-BdzGKbvD.js";import{C as ee}from"./CardContent-B4ITIunY.js";import{S as P}from"./Stack-C8hAk-Ua.js";import{B as z}from"./Box-B21Vn3Wr.js";import{T as d}from"./TextField-ZPSYDyyk.js";import{I as te}from"./InputAdornment-DP5E7Axe.js";import{B as p}from"./Button-BH1WbAiu.js";import{A as se}from"./Alert-NqiMgJWO.js";import{C as k}from"./CircularProgress-DjzG6_YG.js";import{T as oe}from"./TableContainer-C29JBPns.js";import{P as ae}from"./Paper-Dk0UhltF.js";import{T as re,d as ie,b as A,c as a,a as le}from"./TableRow-BlqcCBcb.js";import{I as S}from"./IconButton-Cf6Oa_Gi.js";import{a as B,b as F}from"./DialogContent-iZlfiihu.js";import{D as W}from"./DialogTitle-fL9kXoX8.js";import{T as ne}from"./Typography-DW8TAfFy.js";import{D as N}from"./DialogActions-WyzZcgZE.js";import"./Grid2-TKUllLdh.js";import"./composeClasses-CkcSq-l_.js";import"./index-BwqtTtay.js";import"./useSlotProps-Dmx4i6VU.js";import"./Link-DrUusogV.js";import"./createStack-B05ZxkoV.js";import"./useSlot-BJnJs1tW.js";import"./FormControl-CoJ51_a0.js";import"./utils-DoM3o7-Q.js";import"./useFormControl-D8zMB56u.js";import"./isMuiElement-DUOjtQlD.js";import"./useId-5Do1p0JB.js";import"./formControlState-Dq1zat_P.js";import"./Select-BdS4d3Pw.js";import"./Popover-C4QiusQk.js";import"./isHostComponent-DVu5iVWx.js";import"./Modal-BmV9fUd8.js";import"./getReactNodeRef-CxaND9dZ.js";import"./ownerWindow-CPegdbNg.js";import"./createChainedFunction-BO_9K8Jh.js";import"./utils-C-EoFTAL.js";import"./Portal-BXG2mGLy.js";import"./debounce-Be36O1Ab.js";import"./Grow-rhCcvyQJ.js";import"./List-CPHbMiuQ.js";import"./useControlled-Cuh16IWT.js";import"./resolveProps-CxWqPvcr.js";import"./Close-4pq8Nglm.js";const ce=[{to:"/",title:"Home"},{title:"Reports"},{title:"Hosts Availability"}],rt=()=>{var L;const[O,T]=i.useState([]),[R,w]=i.useState(!1),[D,n]=i.useState(""),[u,M]=i.useState(""),[C,f]=i.useState({open:!1,host:null}),[X,h]=i.useState(!1),[r,c]=i.useState({ip:"",hostname:"",alias:"",service:"",hosts_tags:""}),[m,v]=i.useState(!1),[H,y]=i.useState(null),[J,_]=i.useState(!1),I=async()=>{w(!0),n("");try{const t=await fetch(x+j+"/hosts",{headers:g()});if(t.status===401||t.status===403){b({status:t.status});return}const o=await t.json();if(t.ok){const l=Array.isArray(o)?o.map(s=>({id:s.ID??s.id,ip:s.IP??s.ip,hostname:s.Hostname??s.hostname,alias:s.Alias??s.alias,service:s.Service??s.service,hosts_tags:s.HostsTags??s.hosts_tags??s.hostsTags,created_at:s.CreatedAt??s.created_at})):[];T(l)}else n(o.error||"Failed to fetch hosts")}catch(t){console.error("fetch hosts error",t),n("Failed to fetch hosts")}finally{w(!1)}},K=async t=>{try{const o=await fetch(x+j+`/hosts/${t}`,{method:"DELETE",headers:g()});if(o.status===401||o.status===403)return b({status:o.status});if(o.ok)T(l=>l.filter(s=>s.id!==t)),f({open:!1,host:null});else{const l=await o.json();n(l.error||"Failed to delete host")}}catch(o){console.error("delete host error",o),n("Failed to delete host")}},E=O.filter(t=>{var o,l,s;return((o=t.hostname)==null?void 0:o.toLowerCase().includes(u.toLowerCase()))||((l=t.ip)==null?void 0:l.toLowerCase().includes(u.toLowerCase()))||((s=t.alias)==null?void 0:s.toLowerCase().includes(u.toLowerCase()))});return i.useEffect(()=>{I()},[]),e.jsxs(G,{title:"Hosts Availability",description:"Availability reports for hosts",children:[e.jsx(Q,{title:"Hosts Availability",items:ce}),e.jsx(V,{children:e.jsxs(ee,{children:[e.jsxs(P,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(z,{sx:{minWidth:300},children:e.jsx(d,{placeholder:"Search hosts...",value:u,onChange:t=>M(t.target.value),InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(U,{size:20})})},fullWidth:!0})}),e.jsx(p,{variant:"contained",startIcon:e.jsx($,{}),onClick:()=>h(!0),sx:{width:225},children:"Add Host"})]}),D&&e.jsx(se,{severity:"error",sx:{mb:3},children:D}),R?e.jsx(z,{display:"flex",justifyContent:"center",py:4,children:e.jsx(k,{})}):e.jsx(oe,{component:ae,children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(A,{children:[e.jsx(a,{children:"IP"}),e.jsx(a,{children:"Hostname"}),e.jsx(a,{children:"Alias"}),e.jsx(a,{children:"Service"}),e.jsx(a,{children:"Tags"}),e.jsx(a,{children:"Created"}),e.jsx(a,{align:"center",children:"Actions"})]})}),e.jsx(le,{children:E.length===0?e.jsx(A,{children:e.jsx(a,{colSpan:7,align:"center",children:"No hosts found"})}):E.map(t=>e.jsxs(A,{children:[e.jsx(a,{children:t.ip||"-"}),e.jsx(a,{children:t.hostname||"-"}),e.jsx(a,{children:t.alias||"-"}),e.jsx(a,{children:t.service||"-"}),e.jsx(a,{children:t.hosts_tags||"-"}),e.jsx(a,{children:t.created_at?new Date(t.created_at).toLocaleDateString():"-"}),e.jsx(a,{align:"center",children:e.jsxs(P,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(S,{size:"small",color:"primary",children:e.jsx(Y,{size:16})}),e.jsx(S,{size:"small",color:"warning",onClick:()=>{v(!0),y(t.id),c({ip:t.ip||"",hostname:t.hostname||"",alias:t.alias||"",service:t.service||"",hosts_tags:t.hosts_tags||""}),h(!0)},children:e.jsx(Z,{size:16})}),e.jsx(S,{size:"small",color:"error",onClick:()=>f({open:!0,host:t}),children:e.jsx(q,{size:16})})]})})]},t.id))})]})})]})}),e.jsxs(B,{open:C.open,onClose:()=>f({open:!1,host:null}),children:[e.jsx(W,{children:"Confirm Delete"}),e.jsx(F,{children:e.jsxs(ne,{children:['Delete host "',(L=C.host)==null?void 0:L.hostname,'"?']})}),e.jsxs(N,{children:[e.jsx(p,{onClick:()=>f({open:!1,host:null}),children:"Cancel"}),e.jsx(p,{color:"error",variant:"contained",onClick:()=>{var t;return K((t=C.host)==null?void 0:t.id)},children:"Delete"})]})]}),e.jsxs(B,{open:X,onClose:()=>{h(!1),v(!1),y(null)},fullWidth:!0,maxWidth:"sm",children:[e.jsx(W,{children:m?"Edit Host":"Add Host"}),e.jsxs(F,{children:[e.jsx(d,{label:"IP",fullWidth:!0,margin:"dense",value:r.ip,onChange:t=>c({...r,ip:t.target.value})}),e.jsx(d,{label:"Hostname",fullWidth:!0,margin:"dense",value:r.hostname,onChange:t=>c({...r,hostname:t.target.value})}),e.jsx(d,{label:"Alias",fullWidth:!0,margin:"dense",value:r.alias,onChange:t=>c({...r,alias:t.target.value})}),e.jsx(d,{label:"Service",fullWidth:!0,margin:"dense",value:r.service,onChange:t=>c({...r,service:t.target.value})}),e.jsx(d,{label:"Tags",fullWidth:!0,margin:"dense",value:r.hosts_tags,onChange:t=>c({...r,hosts_tags:t.target.value})})]}),e.jsxs(N,{children:[e.jsx(p,{onClick:()=>h(!1),children:"Cancel"}),e.jsx(p,{variant:"contained",color:"primary",onClick:async()=>{_(!0);try{let t;if(m&&H?t=await fetch(x+j+`/hosts/${H}`,{method:"PUT",headers:{"Content-Type":"application/json",...g()},body:JSON.stringify(r)}):t=await fetch(x+j+"/hosts",{method:"POST",headers:{"Content-Type":"application/json",...g()},body:JSON.stringify(r)}),t.status===401||t.status===403)return b({status:t.status});const o=await t.json();t.ok?(I(),h(!1),c({ip:"",hostname:"",alias:"",service:"",hosts_tags:""}),v(!1),y(null)):n(o.error||(m?"Failed to update host":"Failed to create host"))}catch(t){console.error(t),n(m?"Failed to update host":"Failed to create host")}finally{_(!1)}},children:J?e.jsx(k,{size:20}):m?"Save":"Create"})]})]})]})};export{rt as default};
