import{r as i,j as r,B as d,A as c,z as m}from"./index-CJWZi9CB.js";import{D as ee,X as re,b as se,z as te}from"./index.esm-CBP19pFL.js";import{P as ie}from"./PageContainer-BR_WMDrZ.js";import{B as oe}from"./Breadcrumb-DR6zDa-i.js";import{C as ne}from"./Card-BdzGKbvD.js";import{C as ae}from"./CardContent-B4ITIunY.js";import{S as _}from"./Stack-C8hAk-Ua.js";import{B as le}from"./Box-B21Vn3Wr.js";import{T as u}from"./TextField-ZPSYDyyk.js";import{I as de}from"./InputAdornment-DP5E7Axe.js";import{B as p}from"./Button-BH1WbAiu.js";import{A as ce}from"./Alert-NqiMgJWO.js";import{T as me}from"./TableContainer-C29JBPns.js";import{P as he}from"./Paper-Dk0UhltF.js";import{T as ue,d as pe,b as F,c as o,a as fe}from"./TableRow-BlqcCBcb.js";import{I}from"./IconButton-Cf6Oa_Gi.js";import{a as z,b as P}from"./DialogContent-iZlfiihu.js";import{D as L}from"./DialogTitle-fL9kXoX8.js";import{M as h}from"./MenuItem-DU8MVoCc.js";import{D as U}from"./DialogActions-WyzZcgZE.js";import{C as O}from"./CircularProgress-DjzG6_YG.js";import"./Grid2-TKUllLdh.js";import"./Typography-DW8TAfFy.js";import"./composeClasses-CkcSq-l_.js";import"./index-BwqtTtay.js";import"./useSlotProps-Dmx4i6VU.js";import"./Link-DrUusogV.js";import"./createStack-B05ZxkoV.js";import"./useSlot-BJnJs1tW.js";import"./FormControl-CoJ51_a0.js";import"./utils-DoM3o7-Q.js";import"./useFormControl-D8zMB56u.js";import"./isMuiElement-DUOjtQlD.js";import"./useId-5Do1p0JB.js";import"./formControlState-Dq1zat_P.js";import"./Select-BdS4d3Pw.js";import"./Popover-C4QiusQk.js";import"./isHostComponent-DVu5iVWx.js";import"./Modal-BmV9fUd8.js";import"./getReactNodeRef-CxaND9dZ.js";import"./ownerWindow-CPegdbNg.js";import"./createChainedFunction-BO_9K8Jh.js";import"./utils-C-EoFTAL.js";import"./Portal-BXG2mGLy.js";import"./debounce-Be36O1Ab.js";import"./Grow-rhCcvyQJ.js";import"./List-CPHbMiuQ.js";import"./useControlled-Cuh16IWT.js";import"./resolveProps-CxWqPvcr.js";import"./Close-4pq8Nglm.js";import"./dividerClasses-ORbXH3Pu.js";import"./listItemTextClasses-C__13pSQ.js";const je=[{to:"/",title:"Home"},{title:"Admin"},{title:"Roles"},{title:"Role Bindings"}],jr=()=>{var R;const[W,N]=i.useState([]),[w,q]=i.useState([]),[S,H]=i.useState([]),[xe,v]=i.useState(!1),[A,n]=i.useState(""),[M,f]=i.useState(!1),[l,y]=i.useState({user_id:"",role_id:""}),[j,x]=i.useState(!1),[X,g]=i.useState(!1),[t,b]=i.useState(null),[B,$]=i.useState(""),C=async()=>{v(!0);try{const e=await fetch(d+c+"/admin/roles/bindings",{headers:m()});if(e.ok){const s=await e.json();N(Array.isArray(s)?s:s.bindings||s||[])}}catch(e){console.error("Failed to fetch bindings",e),n("Failed to fetch bindings")}finally{v(!1)}},J=async()=>{try{const e=await fetch(d+c+"/admin/roles",{headers:m()});if(e.ok){const s=await e.json();q(Array.isArray(s)?s:s.roles||[])}}catch(e){console.error("Failed to fetch roles",e)}},K=async()=>{try{const e=await fetch(d+c+"/users",{headers:m()});if(e.ok){const s=await e.json();H(s.users||s||[])}}catch(e){console.error("Failed to fetch users",e)}};i.useEffect(()=>{C(),J(),K()},[]);const Y=async()=>{if(!l.user_id||!l.role_id)return n("User and Role are required");x(!0);try{const e=await fetch(d+c+"/admin/roles/bindings",{method:"POST",headers:{"Content-Type":"application/json",...m()},body:JSON.stringify(l)}),s=await e.json();e.ok?(C(),f(!1),y({user_id:"",role_id:""})):n(s.error||"Failed to create binding")}catch(e){console.error(e),n("Failed to create binding")}finally{x(!1)}},G=async e=>{try{const s=await fetch(d+c+"/admin/roles/bindings/"+e,{method:"DELETE",headers:m()});if(s.ok)C();else{const a=await s.json();n(a.error||"Failed to delete binding")}}catch(s){console.error(s),n("Failed to delete binding")}},Q=e=>{var s,a;b({id:e.id,user_id:e.user_id||((s=e.user)==null?void 0:s.id),role_id:e.role_id||((a=e.role)==null?void 0:a.id)}),g(!0)},V=async()=>{if(!(t!=null&&t.id)||!t.user_id||!t.role_id)return n("User and Role are required");x(!0);try{const e=await fetch(`${d}${c}/admin/roles/bindings/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...m()},body:JSON.stringify({user_id:t.user_id,role_id:t.role_id})}),s=await e.json();e.ok?(g(!1),b(null),C()):n(s.error||"Failed to update binding")}catch(e){console.error(e),n("Failed to update binding")}finally{x(!1)}};return r.jsxs(ie,{title:"Role Bindings",description:"Bind users to roles",children:[r.jsx(oe,{title:"Role Bindings",items:je}),r.jsx(ne,{children:r.jsxs(ae,{children:[r.jsxs(_,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[r.jsx(le,{sx:{minWidth:300},children:r.jsx(u,{placeholder:"Search...",value:B,onChange:e=>$(e.target.value),InputProps:{startAdornment:r.jsx(de,{position:"start",children:r.jsx(ee,{size:20})})},fullWidth:!0})}),r.jsx(p,{variant:"contained",startIcon:r.jsx(re,{}),onClick:()=>f(!0),sx:{width:225},children:"Add Binding"})]}),A&&r.jsx(ce,{severity:"error",sx:{mb:2},children:A}),r.jsx(me,{component:he,children:r.jsxs(ue,{children:[r.jsx(pe,{children:r.jsxs(F,{children:[r.jsx(o,{children:"ID"}),r.jsx(o,{children:"User"}),r.jsx(o,{children:"Role"}),r.jsx(o,{children:"Created"}),r.jsx(o,{align:"center",children:"Actions"})]})}),r.jsx(fe,{children:(W||[]).filter(e=>{var T,k,D,E;const s=(B||"").toLowerCase();if(!s)return!0;const a=((k=(T=e.user)==null?void 0:T.username)==null?void 0:k.toLowerCase())||"",Z=((E=(D=e.role)==null?void 0:D.name)==null?void 0:E.toLowerCase())||"";return a.includes(s)||Z.includes(s)}).map(e=>{var s,a;return r.jsxs(F,{children:[r.jsx(o,{children:e.id}),r.jsx(o,{children:((s=e.user)==null?void 0:s.username)||e.user_id}),r.jsx(o,{children:((a=e.role)==null?void 0:a.name)||e.role_id}),r.jsx(o,{children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),r.jsx(o,{align:"center",children:r.jsxs(_,{direction:"row",spacing:1,justifyContent:"center",children:[r.jsx(I,{size:"small",color:"warning",onClick:()=>Q(e),children:r.jsx(se,{size:16})}),r.jsx(I,{size:"small",color:"error",onClick:()=>G(e.id),children:r.jsx(te,{size:16})})]})})]},e.id)})})]})})]})}),r.jsxs(z,{open:M,onClose:()=>f(!1),fullWidth:!0,maxWidth:"sm",children:[r.jsx(L,{children:"Add Role Binding"}),r.jsx(P,{children:r.jsxs(_,{spacing:2,mt:1,children:[r.jsxs(u,{select:!0,label:"User",value:l.user_id,onChange:e=>y({...l,user_id:e.target.value}),children:[r.jsx(h,{value:"",children:"Select user"}),S.map(e=>r.jsx(h,{value:e.id,children:e.username},e.id))]}),r.jsxs(u,{select:!0,label:"Role",value:l.role_id,onChange:e=>y({...l,role_id:e.target.value}),children:[r.jsx(h,{value:"",children:"Select role"}),w.map(e=>r.jsx(h,{value:e.id,children:e.name},e.id))]})]})}),r.jsxs(U,{children:[r.jsx(p,{onClick:()=>f(!1),children:"Cancel"}),r.jsx(p,{onClick:Y,variant:"contained",disabled:j,children:j?r.jsx(O,{size:18}):"Bind"})]})]}),r.jsxs(z,{open:X,onClose:()=>g(!1),fullWidth:!0,maxWidth:"sm",children:[r.jsx(L,{children:"Edit Role Binding"}),r.jsx(P,{children:r.jsxs(_,{spacing:2,mt:1,children:[r.jsx(u,{label:"User",value:((R=S.find(e=>e.id===(t==null?void 0:t.user_id)))==null?void 0:R.username)||(t==null?void 0:t.user_id)||"",disabled:!0,fullWidth:!0}),r.jsxs(u,{select:!0,label:"Role",value:(t==null?void 0:t.role_id)||"",onChange:e=>b({...t,role_id:e.target.value}),children:[r.jsx(h,{value:"",children:"Select role"}),w.map(e=>r.jsx(h,{value:e.id,children:e.name},e.id))]})]})}),r.jsxs(U,{children:[r.jsx(p,{onClick:()=>g(!1),children:"Cancel"}),r.jsx(p,{onClick:V,variant:"contained",disabled:j,children:j?r.jsx(O,{size:18}):"Save"})]})]})]})};export{jr as default};
