import{r,j as e,B as j,A as x,z as f,C as g}from"./index-CJWZi9CB.js";import{D as ne,X as le,_ as ce,b as de,z as Z}from"./index.esm-CBP19pFL.js";import{P as me}from"./PageContainer-BR_WMDrZ.js";import{B as he}from"./Breadcrumb-DR6zDa-i.js";import{C as ue}from"./Card-BdzGKbvD.js";import{C as pe}from"./CardContent-B4ITIunY.js";import{S as C}from"./Stack-C8hAk-Ua.js";import{B as Q}from"./Box-B21Vn3Wr.js";import{T as d}from"./TextField-ZPSYDyyk.js";import{I as je}from"./InputAdornment-DP5E7Axe.js";import{B as n}from"./Button-BH1WbAiu.js";import{A as w}from"./Alert-NqiMgJWO.js";import{C as D}from"./CircularProgress-DjzG6_YG.js";import{T as xe}from"./TableContainer-C29JBPns.js";import{P as fe}from"./Paper-Dk0UhltF.js";import{T as ge,d as Ce,b as T,c as a,a as ye}from"./TableRow-BlqcCBcb.js";import{T as S}from"./Typography-DW8TAfFy.js";import{C as be}from"./Chip-DQyB0PyW.js";import{I as y}from"./IconButton-Cf6Oa_Gi.js";import{a as R,b as A}from"./DialogContent-iZlfiihu.js";import{D as k}from"./DialogTitle-fL9kXoX8.js";import{D as N}from"./DialogActions-WyzZcgZE.js";import"./Grid2-TKUllLdh.js";import"./composeClasses-CkcSq-l_.js";import"./index-BwqtTtay.js";import"./useSlotProps-Dmx4i6VU.js";import"./Link-DrUusogV.js";import"./createStack-B05ZxkoV.js";import"./useSlot-BJnJs1tW.js";import"./FormControl-CoJ51_a0.js";import"./utils-DoM3o7-Q.js";import"./useFormControl-D8zMB56u.js";import"./isMuiElement-DUOjtQlD.js";import"./useId-5Do1p0JB.js";import"./formControlState-Dq1zat_P.js";import"./Select-BdS4d3Pw.js";import"./Popover-C4QiusQk.js";import"./isHostComponent-DVu5iVWx.js";import"./Modal-BmV9fUd8.js";import"./getReactNodeRef-CxaND9dZ.js";import"./ownerWindow-CPegdbNg.js";import"./createChainedFunction-BO_9K8Jh.js";import"./utils-C-EoFTAL.js";import"./Portal-BXG2mGLy.js";import"./debounce-Be36O1Ab.js";import"./Grow-rhCcvyQJ.js";import"./List-CPHbMiuQ.js";import"./useControlled-Cuh16IWT.js";import"./resolveProps-CxWqPvcr.js";import"./Close-4pq8Nglm.js";const ve=[{to:"/",title:"Home"},{title:"Admin"},{title:"Roles"},{title:"List Roles"}],Ct=()=>{var U,$,q,Y;const[V,E]=r.useState([]),[ee,z]=r.useState(!1),[L,i]=r.useState(""),[m,te]=r.useState(""),[l,h]=r.useState({open:!1,role:null}),[se,u]=r.useState(!1),[re,p]=r.useState(!1),[c,B]=r.useState(null),[W,P]=r.useState(""),[I,O]=r.useState(""),[_,G]=r.useState(!1),[b,F]=r.useState(""),[H,X]=r.useState(""),[J,K]=r.useState(!1),v=async()=>{z(!0),i("");try{const t=await fetch(j+x+"/admin/roles",{method:"GET",headers:f()});if(t.status===401||t.status===403){g({status:t.status});return}const s=await t.json();t.ok?E(Array.isArray(s)?s:s.roles||[]):i(s.error||s.message||"Gagal mengambil data roles")}catch(t){console.error("Fetch roles error:",t),i("Terjadi kesalahan saat mengambil data roles")}finally{z(!1)}},ae=async t=>{try{const s=await fetch(j+x+`/admin/roles/${t}`,{method:"DELETE",headers:f()});if(s.status===401||s.status===403){g({status:s.status});return}if(s.ok)E(o=>o.filter(oe=>oe.id!==t)),h({open:!1,role:null});else{const o=await s.json();i(o.error||o.message||"Gagal menghapus role")}}catch(s){console.error("Delete role error:",s),i("Terjadi kesalahan saat menghapus role")}},ie=async()=>{if(!b){i("Role name is required");return}K(!0),i("");try{const t=await fetch(j+x+"/admin/roles",{method:"POST",headers:{"Content-Type":"application/json",...f()},body:JSON.stringify({name:b,description:H})});if(t.status===401||t.status===403){g({status:t.status});return}const s=await t.json();t.ok?(u(!1),F(""),X(""),v()):i(s.error||s.message||"Gagal menambahkan role")}catch(t){console.error("Add role error:",t),i("Terjadi kesalahan saat menambahkan role")}finally{K(!1)}},M=V.filter(t=>{var s,o;return((s=t.name)==null?void 0:s.toLowerCase().includes(m.toLowerCase()))||((o=t.description)==null?void 0:o.toLowerCase().includes(m.toLowerCase()))});return r.useEffect(()=>{v()},[]),e.jsxs(me,{title:"List Roles",description:"Manage system roles",children:[e.jsx(he,{title:"List Roles",items:ve}),e.jsx(ue,{children:e.jsxs(pe,{children:[e.jsxs(C,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(Q,{sx:{minWidth:300},children:e.jsx(d,{placeholder:"Search roles...",value:m,onChange:t=>te(t.target.value),InputProps:{startAdornment:e.jsx(je,{position:"start",children:e.jsx(ne,{size:20})})},fullWidth:!0})}),e.jsx(n,{variant:"contained",startIcon:e.jsx(le,{}),color:"primary",onClick:()=>u(!0),sx:{width:225},children:"Add New Role"})]}),L&&e.jsx(w,{severity:"error",sx:{mb:3},children:L}),ee?e.jsx(Q,{display:"flex",justifyContent:"center",py:4,children:e.jsx(D,{})}):e.jsx(xe,{component:fe,children:e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs(T,{children:[e.jsx(a,{children:"ID"}),e.jsx(a,{children:"Name"}),e.jsx(a,{children:"Description"}),e.jsx(a,{children:"Native"}),e.jsx(a,{children:"Created"}),e.jsx(a,{align:"center",children:"Actions"})]})}),e.jsx(ye,{children:M.length===0?e.jsx(T,{children:e.jsx(a,{colSpan:6,align:"center",sx:{py:4},children:e.jsx(S,{variant:"body1",color:"textSecondary",children:m?"No roles found matching your search":"No roles found"})})}):M.map(t=>e.jsxs(T,{children:[e.jsx(a,{children:t.id}),e.jsx(a,{children:e.jsx(S,{variant:"subtitle2",fontWeight:600,children:t.name})}),e.jsx(a,{children:t.description||"-"}),e.jsx(a,{children:t.native?e.jsx(be,{size:"small",label:"native",color:"secondary"}):"-"}),e.jsx(a,{children:t.created_at?new Date(t.created_at).toLocaleDateString():"-"}),e.jsx(a,{align:"center",children:e.jsxs(C,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(y,{size:"small",color:"primary",children:e.jsx(ce,{size:16})}),e.jsx(y,{size:"small",color:"warning",onClick:()=>{B(t),P(t.name||""),O(t.description||""),p(!0)},children:e.jsx(de,{size:16})}),t.native?e.jsx(y,{size:"small",color:"inherit",disabled:!0,title:"Native role cannot be deleted",children:e.jsx(Z,{size:16})}):e.jsx(y,{size:"small",color:"error",onClick:()=>h({open:!0,role:t}),children:e.jsx(Z,{size:16})})]})})]},t.id))})]})})]})}),e.jsxs(R,{open:l.open,onClose:()=>h({open:!1,role:null}),children:[e.jsx(k,{children:"Confirm Delete"}),e.jsx(A,{children:(U=l.role)!=null&&U.native?e.jsxs(w,{severity:"warning",children:['Native role "',($=l.role)==null?void 0:$.name,'" cannot be deleted.']}):e.jsxs(S,{children:['Are you sure you want to delete role "',(q=l.role)==null?void 0:q.name,'"? This action cannot be undone.']})}),e.jsxs(N,{children:[e.jsx(n,{onClick:()=>h({open:!1,role:null}),color:"primary",children:"Cancel"}),e.jsx(n,{onClick:()=>{var t;return ae((t=l.role)==null?void 0:t.id)},color:"error",variant:"contained",disabled:(Y=l.role)==null?void 0:Y.native,children:"Delete"})]})]}),e.jsxs(R,{open:se,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{children:"Add New Role"}),e.jsx(A,{children:e.jsxs(C,{spacing:2,mt:1,children:[e.jsx(d,{label:"Role Name",value:b,onChange:t=>F(t.target.value),fullWidth:!0}),e.jsx(d,{label:"Description",value:H,onChange:t=>X(t.target.value),fullWidth:!0,multiline:!0,rows:3})]})}),e.jsxs(N,{children:[e.jsx(n,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(n,{onClick:ie,variant:"contained",disabled:J,children:J?e.jsx(D,{size:18}):"Add Role"})]})]}),e.jsxs(R,{open:re,onClose:()=>p(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{children:"Edit Role"}),e.jsx(A,{children:e.jsxs(C,{spacing:2,mt:1,children:[e.jsx(d,{label:"Role Name",value:W,onChange:t=>P(t.target.value),fullWidth:!0}),e.jsx(d,{label:"Description",value:I,onChange:t=>O(t.target.value),fullWidth:!0,multiline:!0,rows:3}),(c==null?void 0:c.native)&&e.jsx(w,{severity:"info",children:"This is a native role. Name may be restricted by the backend."})]})}),e.jsxs(N,{children:[e.jsx(n,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(n,{onClick:async()=>{if(c){G(!0);try{const t=await fetch(j+x+`/admin/roles/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...f()},body:JSON.stringify({name:W,description:I})});if(t.status===401||t.status===403){g({status:t.status});return}const s=await t.json();t.ok?(p(!1),B(null),v()):i(s.error||s.message||"Gagal memperbarui role")}catch(t){console.error("Edit role error:",t),i("Terjadi kesalahan saat memperbarui role")}finally{G(!1)}}},variant:"contained",disabled:_,children:_?e.jsx(D,{size:18}):"Save Changes"})]})]})]})};export{Ct as default};
